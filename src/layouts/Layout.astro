---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import WhatsAppButton from '../components/WhatsAppButton.astro';
import '../styles/global.css';

interface BreadcrumbItem {
  name: string;
  url?: string;
}

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: string;
  keywords?: string;
  breadcrumbs?: BreadcrumbItem[];
  publishedDate?: string;
  noindex?: boolean;
}

const {
  title,
  description = "Osteópata y masajista en Alpedrete, Sierra de Madrid. Más de 12 años de experiencia en osteopatía estructural, visceral, craneal y masajes terapéuticos. Atendemos Collado Villalba, Moralzarzal, Galapagar y toda la Sierra de Guadarrama.",
  image = "/images/og-default.jpg",
  type = "website",
  keywords = "osteopata alpedrete, masajista alpedrete, osteopatia sierra de madrid, masaje deportivo sierra madrid, osteopata collado villalba, masajista moralzarzal, osteopatia galapagar, fisioterapia sierra de guadarrama, dolor de espalda tratamiento, contracturas cervicales, masaje tailandes madrid, quiromasaje alpedrete, osteopata torrelodones, masajes guadarrama, ciatica osteopatia",
  breadcrumbs = [],
  publishedDate,
  noindex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImageURL = new URL(image, Astro.site);

const breadcrumbSchema = breadcrumbs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((item, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": item.name,
    ...(item.url ? { "item": `https://katycaballeroosteopata.com${item.url}` } : {})
  }))
} : null;
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title>{title}</title>
  <meta name="title" content={title}>
  <meta name="description" content={description}>
  <meta name="keywords" content={keywords}>
  <meta name="author" content="Katy Caballero">
  <meta name="robots" content={noindex ? "noindex, nofollow" : "index, follow"}>

  <!-- Geo Tags para SEO Local -->
  <meta name="geo.region" content="ES-MD">
  <meta name="geo.placename" content="Alpedrete, Madrid">
  <meta name="geo.position" content="40.6631;-4.0270">
  <meta name="ICBM" content="40.6631, -4.0270">
  
  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalURL}>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={type}>
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={socialImageURL}>
  <meta property="og:locale" content="es_ES">
  <meta property="og:site_name" content="Katy Caballero - Osteópata y Masajista">
  {publishedDate && (
    <meta property="article:published_time" content={publishedDate} />
    <meta property="article:author" content="Katy Caballero" />
  )}

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content={canonicalURL}>
  <meta property="twitter:title" content={title}>
  <meta property="twitter:description" content={description}>
  <meta property="twitter:image" content={socialImageURL}>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DSS01LPVMJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-DSS01LPVMJ');
  </script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/logo.png">
  <link rel="apple-touch-icon" href="/images/logo.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Montserrat:wght@300;400;500;600&display=swap" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Montserrat:wght@300;400;500;600&display=swap"></noscript>
  
  <!-- Schema.org markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HealthAndBeautyBusiness",
    "name": "Katy Caballero - Osteópata y Masajista",
    "description": "Centro de osteopatía y masajes en Alpedrete, Sierra de Madrid. Tratamientos de osteopatía estructural, visceral y craneal, masaje deportivo, tailandés y terapéutico.",
    "image": "https://katycaballeroosteopata.com/images/logo.png",
    "telephone": "+34643961065",
    "email": "katycaballero.osteopata@gmail.com",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Calle Río Guadarrama 2",
      "addressLocality": "Alpedrete",
      "addressRegion": "Madrid",
      "postalCode": "28430",
      "addressCountry": "ES"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "40.6631",
      "longitude": "-4.0270"
    },
    "areaServed": [
      {"@type": "City", "name": "Alpedrete"},
      {"@type": "City", "name": "Collado Villalba"},
      {"@type": "City", "name": "Moralzarzal"},
      {"@type": "City", "name": "Galapagar"},
      {"@type": "City", "name": "Guadarrama"},
      {"@type": "City", "name": "Torrelodones"},
      {"@type": "City", "name": "El Escorial"},
      {"@type": "City", "name": "Cercedilla"},
      {"@type": "City", "name": "Navacerrada"},
      {"@type": "City", "name": "Collado Mediano"},
      {"@type": "City", "name": "Becerril de la Sierra"},
      {"@type": "City", "name": "Los Molinos"},
      {"@type": "AdministrativeArea", "name": "Sierra de Guadarrama"},
      {"@type": "AdministrativeArea", "name": "Sierra de Madrid"}
    ],
    "url": "https://katycaballeroosteopata.com",
    "priceRange": "€€",
    "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
        "opens": "09:00",
        "closes": "20:00"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "Saturday",
        "opens": "10:00",
        "closes": "14:00"
      }
    ],
    "sameAs": [
      "https://www.instagram.com/katycaballero.osteopata"
    ],
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Servicios de osteopatía y masajes",
      "itemListElement": [
        {"@type": "Offer", "itemOffered": {"@type": "Service", "name": "Osteopatía estructural, visceral y sacrocraneal"}},
        {"@type": "Offer", "itemOffered": {"@type": "Service", "name": "Masaje deportivo"}},
        {"@type": "Offer", "itemOffered": {"@type": "Service", "name": "Masaje tradicional tailandés"}},
        {"@type": "Offer", "itemOffered": {"@type": "Service", "name": "Masaje corporal con aceite"}},
        {"@type": "Offer", "itemOffered": {"@type": "Service", "name": "Masaje para embarazadas"}}
      ]
    }
  }
  </script>
  {breadcrumbSchema && (
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  )}
</head>
<body>
  <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
  <Header />

  <main id="main-content">
    <slot />
  </main>
  
  <Footer />
  <WhatsAppButton />
  
  <script>
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
    
    // Navbar shadow on scroll
    window.addEventListener('scroll', () => {
      const nav = document.querySelector('.nav');
      if (nav) {
        if (window.scrollY > 50) {
          nav.classList.add('scrolled');
        } else {
          nav.classList.remove('scrolled');
        }
      }
    });
  </script>
</body>
</html>
